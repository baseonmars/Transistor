/*!
 * jQuery Cookie Plugin
 * https://github.com/carhartl/jquery-cookie
 *
 * Copyright 2011, Klaus Hartl
 * Dual licensed under the MIT or GPL Version 2 licenses.
 * http://www.opensource.org/licenses/mit-license.php
 * http://www.opensource.org/licenses/GPL-2.0
 */
function utf8_encode(a){if(a===null||typeof a=="undefined")return"";var b=a+"",c="",d,e,f=0;d=e=0,f=b.length;for(var g=0;g<f;g++){var h=b.charCodeAt(g),i=null;h<128?e++:h>127&&h<2048?i=String.fromCharCode(h>>6|192)+String.fromCharCode(h&63|128):i=String.fromCharCode(h>>12|224)+String.fromCharCode(h>>6&63|128)+String.fromCharCode(h&63|128),i!==null&&(e>d&&(c+=b.slice(d,e)),c+=i,d=e=g+1)}return e>d&&(c+=b.slice(d,f)),c}function md5(a){var b,c=function(a,b){return a<<b|a>>>32-b},d=function(a,b){var c,d,e,f,g;return e=a&2147483648,f=b&2147483648,c=a&1073741824,d=b&1073741824,g=(a&1073741823)+(b&1073741823),c&d?g^2147483648^e^f:c|d?g&1073741824?g^3221225472^e^f:g^1073741824^e^f:g^e^f},e=function(a,b,c){return a&b|~a&c},f=function(a,b,c){return a&c|b&~c},g=function(a,b,c){return a^b^c},h=function(a,b,c){return b^(a|~c)},i=function(a,b,f,g,h,i,j){return a=d(a,d(d(e(b,f,g),h),j)),d(c(a,i),b)},j=function(a,b,e,g,h,i,j){return a=d(a,d(d(f(b,e,g),h),j)),d(c(a,i),b)},k=function(a,b,e,f,h,i,j){return a=d(a,d(d(g(b,e,f),h),j)),d(c(a,i),b)},l=function(a,b,e,f,g,i,j){return a=d(a,d(d(h(b,e,f),g),j)),d(c(a,i),b)},m=function(a){var b,c=a.length,d=c+8,e=(d-d%64)/64,f=(e+1)*16,g=new Array(f-1),h=0,i=0;while(i<c)b=(i-i%4)/4,h=i%4*8,g[b]=g[b]|a.charCodeAt(i)<<h,i++;return b=(i-i%4)/4,h=i%4*8,g[b]=g[b]|128<<h,g[f-2]=c<<3,g[f-1]=c>>>29,g},n=function(a){var b="",c="",d,e;for(e=0;e<=3;e++)d=a>>>e*8&255,c="0"+d.toString(16),b+=c.substr(c.length-2,2);return b},o=[],p,q,r,s,t,u,v,w,x,y=7,z=12,A=17,B=22,C=5,D=9,E=14,F=20,G=4,H=11,I=16,J=23,K=6,L=10,M=15,N=21;a=this.utf8_encode(a),o=m(a),u=1732584193,v=4023233417,w=2562383102,x=271733878,b=o.length;for(p=0;p<b;p+=16)q=u,r=v,s=w,t=x,u=i(u,v,w,x,o[p+0],y,3614090360),x=i(x,u,v,w,o[p+1],z,3905402710),w=i(w,x,u,v,o[p+2],A,606105819),v=i(v,w,x,u,o[p+3],B,3250441966),u=i(u,v,w,x,o[p+4],y,4118548399),x=i(x,u,v,w,o[p+5],z,1200080426),w=i(w,x,u,v,o[p+6],A,2821735955),v=i(v,w,x,u,o[p+7],B,4249261313),u=i(u,v,w,x,o[p+8],y,1770035416),x=i(x,u,v,w,o[p+9],z,2336552879),w=i(w,x,u,v,o[p+10],A,4294925233),v=i(v,w,x,u,o[p+11],B,2304563134),u=i(u,v,w,x,o[p+12],y,1804603682),x=i(x,u,v,w,o[p+13],z,4254626195),w=i(w,x,u,v,o[p+14],A,2792965006),v=i(v,w,x,u,o[p+15],B,1236535329),u=j(u,v,w,x,o[p+1],C,4129170786),x=j(x,u,v,w,o[p+6],D,3225465664),w=j(w,x,u,v,o[p+11],E,643717713),v=j(v,w,x,u,o[p+0],F,3921069994),u=j(u,v,w,x,o[p+5],C,3593408605),x=j(x,u,v,w,o[p+10],D,38016083),w=j(w,x,u,v,o[p+15],E,3634488961),v=j(v,w,x,u,o[p+4],F,3889429448),u=j(u,v,w,x,o[p+9],C,568446438),x=j(x,u,v,w,o[p+14],D,3275163606),w=j(w,x,u,v,o[p+3],E,4107603335),v=j(v,w,x,u,o[p+8],F,1163531501),u=j(u,v,w,x,o[p+13],C,2850285829),x=j(x,u,v,w,o[p+2],D,4243563512),w=j(w,x,u,v,o[p+7],E,1735328473),v=j(v,w,x,u,o[p+12],F,2368359562),u=k(u,v,w,x,o[p+5],G,4294588738),x=k(x,u,v,w,o[p+8],H,2272392833),w=k(w,x,u,v,o[p+11],I,1839030562),v=k(v,w,x,u,o[p+14],J,4259657740),u=k(u,v,w,x,o[p+1],G,2763975236),x=k(x,u,v,w,o[p+4],H,1272893353),w=k(w,x,u,v,o[p+7],I,4139469664),v=k(v,w,x,u,o[p+10],J,3200236656),u=k(u,v,w,x,o[p+13],G,681279174),x=k(x,u,v,w,o[p+0],H,3936430074),w=k(w,x,u,v,o[p+3],I,3572445317),v=k(v,w,x,u,o[p+6],J,76029189),u=k(u,v,w,x,o[p+9],G,3654602809),x=k(x,u,v,w,o[p+12],H,3873151461),w=k(w,x,u,v,o[p+15],I,530742520),v=k(v,w,x,u,o[p+2],J,3299628645),u=l(u,v,w,x,o[p+0],K,4096336452),x=l(x,u,v,w,o[p+7],L,1126891415),w=l(w,x,u,v,o[p+14],M,2878612391),v=l(v,w,x,u,o[p+5],N,4237533241),u=l(u,v,w,x,o[p+12],K,1700485571),x=l(x,u,v,w,o[p+3],L,2399980690),w=l(w,x,u,v,o[p+10],M,4293915773),v=l(v,w,x,u,o[p+1],N,2240044497),u=l(u,v,w,x,o[p+8],K,1873313359),x=l(x,u,v,w,o[p+15],L,4264355552),w=l(w,x,u,v,o[p+6],M,2734768916),v=l(v,w,x,u,o[p+13],N,1309151649),u=l(u,v,w,x,o[p+4],K,4149444226),x=l(x,u,v,w,o[p+11],L,3174756917),w=l(w,x,u,v,o[p+2],M,718787259),v=l(v,w,x,u,o[p+9],N,3951481745),u=d(u,q),v=d(v,r),w=d(w,s),x=d(x,t);var O=n(u)+n(v)+n(w)+n(x);return O.toLowerCase()}define("../lib/class",[],function(){var a=!1,b=/xyz/.test(function(){xyz})?/\b_super\b/:/.*/,c={};return c.Class=function(){},c.Class.extend=function(c){function g(){!a&&this.init&&this.init.apply(this,arguments)}var d=this.prototype;a=!0;var e=new this;a=!1;for(var f in c)e[f]=typeof c[f]=="function"&&typeof d[f]=="function"&&b.test(c[f])?function(a,b){return function(){var c=this._super;this._super=d[a];var e=b.apply(this,arguments);return this._super=c,e}}(f,c[f]):c[f];return g.prototype=e,g.prototype.constructor=g,g.extend=arguments.callee,g},c.Class}),define("../src/playlist.js",["require","../lib/class"],function(a){var b=a("../lib/class"),c=b.extend({init:function(){this.reset()},_extract:function(a,b){var c;return this.cursor<a.length?(c=a[this.cursor],this.exhausted=!1):(c=!1,this.exhausted=!0),c},current:function(){return this.exhausted?!1:this.tracks[this.cursor]},append:function(a){this.tracks=this.tracks.concat(a||[]),this.length=this.tracks.length},getTracks:function(){return this.tracks},reset:function(){this.cursor=0,this.exhausted=!0,this.tracks=[],this.length=0},next:function(){var a;return this.exhausted?a=this._extract(this.tracks,this.cursor):(this.cursor++,a=this._extract(this.tracks,this.cursor)),a}});return c}),define("../src/api/responses/track.js",[],function(){return function(a){var b={album:a.album,albumid:a.extension.albumid,application:a.extension.application,artist:a.creator,artistid:a.extension.artistid,artistpage:a.extension.artistpage,buyAlbumURL:a.extension.buyAlbumURL,buyTrackURL:a.extension.buyTrackURL,context:a.extension.context,duration:a.duration,explicit:a.extension.explicit,freeTrackURL:a.extension.freeTrackURL,identifier:a.identifier,image:a.image,location:a.location,loved:a.extension.loved,streamid:a.extension.streamid,title:a.title,trackauth:a.extension.trackauth,trackpage:a.extension.trackpage};return b}}),define("../src/api/responses/xspf.js",["./track.js"],function(a){return function(b){var c={title:b.playlist.title,creator:b.playlist.creator,date:new Date(Date(b.playlist.date)),expiry:new Date(+(new Date)+b.playlist.link["#text"]*1e3),tracks:[]},d=b.playlist.trackList.track;for(var e=0;e<d.length;e++)c.tracks.push(a(d[e]));return c}}),define("../src/api/services/radio.js",["../responses/xspf.js"],function(a){return Radio={"package":"radio",methods:{getPlaylist:{auth:!0,method:"GET",parser:function(b){return a(b)}},tune:{auth:!0,method:"POST",parser:function(a){return a}}}},Radio}),define("../src/api/responses/ok.js",[],function(){return function(a){return a.status==="ok"}}),define("../src/api/responses/nowPlaying.js",[],function(){return function(a){var b=a.nowplaying,c={artist:{name:b.artist["#text"],corrected:b.artist.corrected},albumArtist:{name:b.albumArtist["#text"],corrected:b.albumArtist.corrected},track:{name:b.track["#text"],corrected:b.track.corrected},album:{name:b.album["#text"],corrected:b.album.corrected},ignoredMessage:{code:b.ignoredMessage.code,message:b.ignoredMessage["#text"]}};return c}}),define("../src/api/services/track.js",["../responses/ok.js","../responses/nowPlaying.js"],function(a,b){var c={"package":"track",methods:{love:{auth:!0,method:"POST",parser:function(b){return a(b)}},ban:{auth:!0,method:"POST",parser:function(b){return a(b)}},unlove:{auth:!0,method:"POST",parser:function(b){return a(b,type)}},updateNowPlaying:{auth:!0,method:"POST",parser:function(a){return b(a)}},scrobble:{auth:!0,method:"POST",parser:function(a){return a}}}};return c}),define("../src/api/responses/session.js",[],function(){return function(a){var b=a.session,c={username:b.name,key:b.key,subscriber:b.subscriber};return c}}),define("../src/api/services/auth.js",["../responses/session.js"],function(a){var b={"package":"auth",methods:{getSession:{auth:"auth",method:"GET",parser:function(b){return a(b)}}}};return b}),define("../src/api/services/artist.js",[],function(){var a={"package":"artist",methods:{getInfo:{auth:!1,method:"GET",parser:function(a){return a}}}};return a}),define("../src/api/services",["./services/radio.js","./services/track.js","./services/auth.js","./services/artist.js"],function(a,b,c,d){var e={};return jQuery.each(a.methods,function(b,c){var d=a["package"]+"."+b;e[d]=c}),jQuery.each(b.methods,function(a,c){var d=b["package"]+"."+a;e[d]=c}),jQuery.each(c.methods,function(a,b){var d=c["package"]+"."+a;e[d]=b}),jQuery.each(d.methods,function(a,b){var c=d["package"]+"."+a;e[c]=b}),e}),define("../lib/md5.js",function(){}),define("../src/api/lfmclient.js",["./services","../../lib/md5.js"],function(a){var b=function(b,c,d){this.apiKey=b,this.secret=c,this.session=d,this.baseUrl="http://ws.audioscrobbler.com/2.0/",this.authUrl="http://www.last.fm/api/auth"};return b.prototype.request=function(a,b,c,d){b=b||{};var e=jQuery.ajax({type:this.typeOf(a),url:this.baseUrl,data:this.getParams(a,b)});return e.promise().pipe(this.parserFor(a)).done(c).fail(d)},b.prototype.authFlow=function(){window.location.assign([this.authUrl,"?api_key=",this.apiKey,"&cb=",encodeURIComponent(location.href)].join(""))},b.prototype.parserFor=function(b){return function(c,d,e){var f;return c.hasOwnProperty("error")?f=jQuery.Deferred().rejectWith(c.error):f=a[b]&&a[b].parser(c),f}},b.prototype.error=function(a){},b.prototype.typeOf=function(b){return a[b]&&a[b].method},b.prototype.authType=function(b){return a[b]&&a[b].auth},b.prototype.getParams=function(a,b){var c=jQuery.extend({method:a,api_key:this.apiKey,format:"json",sk:this.session,api_sig:this.sign(a,b)},b);switch(this.authType(a)){case"auth":delete c.sk;break;case!1:delete c.sk,delete c.api_sig;break;default:}return c},b.prototype.sign=function(a,b){var c,d,e=["method"+a,"api_key"+this.apiKey];this.authType(a)===!0&&e.push("sk"+this.session);for(c in b)e.push(c+b[c]);return d=e.sort().join("")+this.secret,md5(d)},b}),define("../src/player.js",["../lib/class"],function(a){var b=0,c=function(){return++b},d=a.extend({init:function(a){this.id=c(),this.playlist=null,this.volume=100,this.setupDevice(a?a:window.soundManager,this.onSMReady)},play:function(a){if(a){this.audio&&this.audio.playState===1&&this.audio.unload();var b=this,c=b.device.createSound({id:"track"+a.streamid,url:a.location,autoLoad:!0,autoPlay:!0,multishop:!1,volume:this.volume,onfinish:function(){amplify.publish("transistorplayer:finished",b.id,a)},onstop:function(){amplify.publish("transistorplayer:stopped",b.id,a)},onpause:function(){amplify.publish("transistorplayer:paused",b.id,a)},onresume:function(){amplify.publish("transistorplayer:resumed",b.id,a)},onplay:function(){amplify.publish("transistorplayer:playing",b.id,a)},onsuspend:function(){amplify.publish("transistorplayer:suspended",b.id,a)},whileplaying:function(){amplify.publish("transistorplayer:whileplaying",b.id,a,{position:this.position,duration:this.duration})}});this.audio=c}else this.hasTrack()&&this.audio.resume()},pause:function(){this.audio.pause()},setVolume:function(a){this.volume=a,this.audio&&self.device.setVolume(this.audio.sID,a)},onSMReady:function(){amplify.publish("transistorplayer:ready",this.id)},hasTrack:function(){return this.audio&&this.audio.playState===1},setupDevice:function(a,b){var c=this;a.onready(function(){c.device=a,b.call(c)})}});return d}),function(a,b){function i(a,b){var c=decodeURI(a),e=f[b||!1?"strict":"loose"].exec(c),i={attr:{},param:{},seg:{}},j=14;while(j--)i.attr[d[j]]=e[j]||"";return i.param.query={},i.param.fragment={},i.attr.query.replace(g,function(a,b,c){b&&(i.param.query[b]=c)}),i.attr.fragment.replace(h,function(a,b,c){b&&(i.param.fragment[b]=c)}),i.seg.path=i.attr.path.replace(/^\/+|\/+$/g,"").split("/"),i.seg.fragment=i.attr.fragment.replace(/^\/+|\/+$/g,"").split("/"),i.attr.base=i.attr.host?i.attr.protocol+"://"+i.attr.host+(i.attr.port?":"+i.attr.port:""):"",i}function j(a){var d=a.tagName;return d!==b?c[d.toLowerCase()]:d}var c={a:"href",img:"src",form:"action",base:"href",script:"src",iframe:"src",link:"href"},d=["source","protocol","authority","userInfo","user","password","host","port","relative","path","directory","file","query","fragment"],e={anchor:"fragment"},f={strict:/^(?:([^:\/?#]+):)?(?:\/\/((?:(([^:@]*):?([^:@]*))?@)?([^:\/?#]*)(?::(\d*))?))?((((?:[^?#\/]*\/)*)([^?#]*))(?:\?([^#]*))?(?:#(.*))?)/,loose:/^(?:(?![^:@]+:[^:@\/]*@)([^:\/?#.]+):)?(?:\/\/)?((?:(([^:@]*):?([^:@]*))?@)?([^:\/?#]*)(?::(\d*))?)(((\/(?:[^?#](?![^?#\/]*\.[^?#\/.]+(?:[?#]|$)))*\/?)?([^?#\/]*))(?:\?([^#]*))?(?:#(.*))?)/},g=/(?:^|&|;)([^&=;]*)=?([^&;]*)/g,h=/(?:^|&|;)([^&=;]*)=?([^&;]*)/g;a.fn.url=function(b){var c="";return this.length&&(c=a(this).attr(j(this[0]))||""),a.url(c,b)},a.url=function(a,c){return arguments.length===1&&a===!0&&(c=!0,a=b),c=c||!1,a=a||window.location.toString(),{data:i(a,c),attr:function(a){return a=e[a]||a,a!==b?this.data.attr[a]:this.data.attr},param:function(a){return a!==b?this.data.param.query[a]:this.data.param.query},fparam:function(a){return a!==b?this.data.param.fragment[a]:this.data.param.fragment},segment:function(a){return a===b?this.data.seg.path:(a=a<0?this.data.seg.path.length+a:a-1,this.data.seg.path[a])},fsegment:function(a){return a===b?this.data.seg.fragment:(a=a<0?this.data.seg.fragment.length+a:a-1,this.data.seg.fragment[a])}}}}(jQuery),define("../lib/jquery.url.js",function(){}),function(a){a.cookie=function(b,c,d){if(arguments.length>1&&(!/Object/.test(Object.prototype.toString.call(c))||c===null||c===undefined)){d=a.extend({},d);if(c===null||c===undefined)d.expires=-1;if(typeof d.expires=="number"){var e=d.expires,f=d.expires=new Date;f.setDate(f.getDate()+e)}return c=String(c),document.cookie=[encodeURIComponent(b),"=",d.raw?c:encodeURIComponent(c),d.expires?"; expires="+d.expires.toUTCString():"",d.path?"; path="+d.path:"",d.domain?"; domain="+d.domain:"",d.secure?"; secure":""].join("")}d=c||{};var g=d.raw?function(a){return a}:decodeURIComponent,h=document.cookie.split("; ");for(var i=0,j;j=h[i]&&h[i].split("=");i++)if(g(j[0])===b)return g(j[1]||"");return null}}(jQuery),define("../lib/jquery.cookie.js",function(){}),define("transistor",["../lib/class","../src/playlist.js","../src/api/lfmclient.js","../src/player.js","../lib/jquery.url.js","../lib/jquery.cookie.js"],function(a,b,c,d){var e=a.extend({init:function(a){a=a||{},this.player=a.player||new d(a.sm2),this.api=a.api||new c(a.key,a.secret,a.session),this.playlist=a.playlist||new b,this.scrobbling=!1===a.scrobble?!1:!0,this.playlist.api=this.api,this.player.playlist=this.playlist,this.station=null;var e=this;amplify.subscribe("transistorplayer:finished",this,this.onFinished),amplify.subscribe("transistorplayer:playing",this,this.onNowPlaying),amplify.subscribe("transistorplayer:scrobblepoint",this,this.onScrobblePoint),amplify.subscribe("transistorplayer:whileplaying",this,this.onPlayback);var f=jQuery.url().param("token");!this.api.session&&f?this.getSession(f):(!jQuery.cookie("transistor"),this.auth())},auth:function(a){if(a)this.api.session=a;else{var b=jQuery.cookie("transistor");b?this.api.session=b:this.api.authFlow()}},deauth:function(){jQuery.cookie("transistor",null),jQuery.cookie("transistorU",null),this.api.session=null},getSession:function(a){var b=this.api.request("auth.getSession",{token:a}),c=this.api.request("auth.getSession",{token:a}),d=this;c.done(function(a){d.api.session=a.key,jQuery.cookie("transistor",a.key,{expires:365}),jQuery.cookie("transistorU",a.username,{expires:365}),amplify.publish("transistor:authorised",a),window.history&&window.history.pushState&&window.history.pushState(null,window.document.title,window.location.pathname)}),c.fail(function(a){console.log("Auth failed",a)})},tune:function(a,b,c){var d=this,e=this.api.request("radio.tune",{station:a});return e.done(b).fail(c),e.done(function(a){d.station=a,amplify.publish("transistor:tuned",a)}),e},play:function(a,b){var c=jQuery.Deferred();c.done(a).fail(b);if(this.player.hasTrack())try{this.player.play(),c.resolve()}catch(d){c.reject(d)}else c=this.next(a,b);return c},pause:function(){this.paused=!0,this.player.pause()},skip:function(a,b){var c=this.playlist.current(),d=this.next().done(a).fail(b);return c&&amplify.publish("transistor:skipped",c),d},next:function(a,b){var c=this.playlist.next(),d=jQuery.Deferred().done(a).fail(b);if(!c){d=this.api.request("radio.getPlaylist",{rtp:1});var e=this;d.done(function(a){e.playlist.append(a.tracks),e.player.play(e.playlist.next())}),d.fail(b)}else try{this.player.play(c),d.resolve()}catch(f){d.reject(f)}return d},love:function(a,b,c){a=a||this.playlist.current();var d=this.api.request("track.love",{track:a.title,artist:a.artist}).done(b).fail(c);return d.done(function(){a.loved=!0,amplify.publish("transistor:loved",a)}),d},unlove:function(a,b,c){a=a||this.playlist.current();var d=this.api.request("track.unlove",{track:a.title,artist:a.artist}).done(b).fail(c);return d.done(function(){a.loved=!1,amplify.publish("transistor:unloved",a)}),d},ban:function(a,b,c){a=a||this.playlist.current();var d=this.api.request("track.ban",{track:a.title,artist:a.artist}).done(b).fail(c),e=this;return d.done(function(){a.banned=!0,amplify.publish("transistor:banned",a),e.skip()}),d},scrobble:function(a,b,c){var d;return this.scrobbling?(a=a||this.playlist.current(),d=this.api.request("track.scrobble",{artist:a.artist,track:a.title,timestamp:a.start,album:a.album,duration:Math.floor(a.duration/1e3),chosenByUser:a.chosenByUser?1:0}).done(b).fail(c),d.done(function(){amplify.publish("transistor:scrobbled",a)})):d=jQuery.Deferred().fail(c).reject(),d},setVolume:function(a){this.player.setVolume(a)},setScrobble:function(a){this.scrobble=a},getUsername:function(){var a=!1;return this.api.session&&(a=jQuery.cookie("transistorU")),a},scrobblePoint:function(a){var b=3e4,c=24e4,d=a.duration,e,f;return d>=b?(f=Math.floor(d/2),f>=c?e=c:e=f):e=!1,e},onNowPlaying:function(a,b){if(this.player.id!==a)return;b.start=Math.floor((new Date).getTime()/1e3),b.scrobblePoint=this.scrobblePoint(b);var c;this.scrobbling&&this.api.request("track.updateNowPlaying",{track:b.title,artist:b.artist,album:b.album,duration:Math.floor(b.duration/1e3)})},onFinished:function(a,b){if(this.player.id!==a)return;this.play()},onPlayback:function(a,b,c){if(this.player.id!==a)return;!b.scrobbled&&b.scrobblePoint&&c.position>=b.scrobblePoint&&(b.scrobbled=!0,this.scrobble(b))}});return e})